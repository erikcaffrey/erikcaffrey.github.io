I"≠5<p>Hace ya un tiempo que comenc√© a desarrollar aplicaciones m√≥viles para android (si cuando android era feo ‚Äò2.2‚Äô y no exist√≠a material design) y a lo largo de este proceso he aprendido infinidad de cosas y es que diario aprendo algo nuevo mientras trabajo en mi d√≠a a d√≠a escribiendo aplicaciones ;pero lleg√≥ un momento en el que me sent√≠ preocupado por la calidad de mi c√≥digo y comenc√© a cuestionarme:</p>

<ul>
  <li>¬øC√≥mo es que se escriben aplicaciones de la calidad?</li>
  <li>¬øQuien escribe el c√≥digo?</li>
  <li>¬øQue tiene ese c√≥digo de los ingenieros de google que el mio no tenga?</li>
  <li>¬øPorque sus aplicaciones no truenan?</li>
  <li>¬øPor qu√© son tan bonitas sus aplicaciones y funcionales m√°s all√° de que sean personas con mucho talento?</li>
</ul>

<p>Me intrigaba saber por qu√© mi software no era tan bueno y la respuesta la encontr√© cuando comenc√© a estudiar temas de <a href="http://www.oodesign.com/">Ingenier√≠a de Software</a>, descubr√≠ las buenas pr√°cticas, <a href="http://www.amazon.com/gp/product/0201633612/ref=as_li_tl?ie=UTF8&amp;camp=1789&amp;creative=9325&amp;creativeASIN=0201633612&amp;linkCode=as2&amp;tag=wwwconsultguc-20&amp;linkId=B53D2MJ6G5FL7J5R">los patrones de dise√±o</a>, las arquitecturas y los test, etc.
En ese momento realmente me di cuenta que hab√≠a un mundo detr√°s que iba m√°s all√° de pantallas, controles y men√∫s, me obsesione mucho que comenc√© a investigar y estudiar m√°s para poder darle la respuesta a cada una de mis preguntas y aunque seguir√© en ese proceso de mejora todo el tiempo esta vez quiero debatir ese camino que hace m√°s <a href="http://www.amazon.com/gp/product/0135974445/ref=as_li_tl?ie=UTF8&amp;camp=1789&amp;creative=9325&amp;creativeASIN=0135974445&amp;linkCode=as2&amp;tag=wwwconsultguc-20&amp;linkId=VJEGNW65CZHRRPTY">saludable al software</a> y para ello me gustar√≠a que pensaras en esta frase antes de comenzar a escribir c√≥digo <strong>‚ÄúClean code always looks like it was written by someone who cares‚Äù</strong> porque escribir buen c√≥digo es nuestra responsabilidad como ingenieros.</p>

<p>Hay que tener en cuenta que escribir software de calidad es muy complejo pero el punto clave est√° en que para construir un software de calidad necesitas conocer sobre ingenier√≠a de software como lo he mencionado arriba, conocer metodologias de desarrollo, principios de la programaci√≥n, conocer patrones de dise√±o m√°s no reinventar la rueda y sobre todo una base es decir una Arquitectura de software es fundamental porque te van a obligar a separar tu software en capas y eso beneficiara a que escribas c√≥digo de forma legible, mantenible y testable. Tu no puedes dar <strong>mantenimiento</strong> o hacer cambios a una aplicaci√≥n m√≥vil si tu c√≥digo no es mantenible, tu no puedes escribir <strong>test</strong> si tu no tienes una arquitectura que te permita hacerlo.</p>

<p>Con el paso del tiempo y en mi proceso de mejorar la calidad de mi software conoc√≠ <a href="https://blog.8thlight.com/uncle-bob/2012/08/13/the-clean-architecture.html">‚ÄúThe Clean Architecture‚Äù</a> gracias a un blog post muy famoso del gran <a href="https://twitter.com/unclebobmartin">T√≠o Bob</a> (Robert Cecil Martin) y es que es algo de lo que se ha venido hablando en los √∫ltimos a√±os bastante dentro de la comunidad android principalmente en Espa√±a y parte de Europa.</p>

<p><strong>Voy a comenzar describiendo lo que he aprendido  a lo largo de este tiempo revisando code examples, charlas y blog posts de Clean Archictecture de diversas fuentes.</strong></p>

<h1 id="the-clean-architecture">The Clean Architecture</h1>

<p>Surge con la problem√°tica que en la mayor√≠a de los desarrollos en los cuales existe un framework se encuentra m√°s c√≥digo que lo representa, en lugar del problema que est√° resolviendo, es decir la idea es centrarse en lo que tiene que hacer la aplicaci√≥n como tal y es por ello que dice que debemos de pensar en √©l framework como el mecanismo de paso de mensajes hacia nuestro software, el cual se debe mirar como una herramienta o plugin de lo que queremos realizar.</p>

<p>El autor dice en varias de sus <a href="https://www.youtube.com/watch?v=Nltqi7ODZTM">charlas</a> que m√°s que una arquitectura s√≥lo son una serie de condiciones que se deben cumplir para que una arquitectura de considere <strong>‚Äùclean‚Äù</strong>, solo son una serie de reglas que lo √∫nico que van a hacer es dividir el software en capas.</p>

<p><img src="/images/2016/1/clean_archi.png" alt="clean_archi" class="center-image" /></p>

<p>Antes de comenzar a describir los componentes importantes del esquema debes tener en cuenta que no es obligatorio ni mucho menos mandatorio usar solo 4 c√≠rculos ya que de acuerdo a Uncle Bob solo son esquem√°ticos y quiz√°s tu problema necesita de m√°s para poder ser resuelto.</p>

<p>Lo √∫nico que nos dice es que hay que respetar la <strong>Dependency Rule</strong>: <em>‚ÄúEl c√≥digo fuente s√≥lo puede apuntar hacia adentro‚Äú</em>.</p>

<h3 id="entities">Entities</h3>

<p>Son aquellos objetos que van a representar los actores importantes de la l√≥gica de negocio de nuestra aplicaci√≥n.</p>

<h3 id="use-cases">Use Cases</h3>

<p>Est√°n muy relacionados con las entidades y son los encargados de implementar l√≥gica de negocio de nuestra aplicaci√≥n, ya que van a orientar todas aquellas interacciones del flujo de datos y entidades dejando al framework fuera de todo esto (en nuestro caso el sdk android), tambi√©n se conocen como interactores.</p>

<p><em>(En ingenier√≠a de software un caso de uso se define como: ‚ÄúUna secuencia de interacciones que se encargan de modelar alguna acci√≥n que quiero que mi software realice‚Äù)</em></p>

<h3 id="interface-adapters">Interface Adapters</h3>

<p>Convierten los datos en el formato m√°s conveniente para los casos de uso y entidades. (De manera recurrente aqui encontraras controladores y presentadores.)</p>

<h3 id="frameworks-and-drivers">Frameworks and Drivers</h3>

<p>Aqu√≠ es donde residen los detalles y todo ese conjunto de plataformas externas y herramientas como puede ser la UI, Web, DB , Devices, etc. Generalmente solo se deben comunicar con el siguiente c√≠rculo a su interior.</p>

<h2 id="android-clean-architecture">Android Clean Architecture</h2>

<p><img src="/images/2016/1/android_archi.png" alt="android_archi" class="center-image" /></p>

<p>Este esquema es una representaci√≥n de c√≥mo se aplica el <strong>Clean Architecture</strong> en una aplicaci√≥n <strong>android</strong> ya que gracias a la gran participaci√≥n de muchos desarrolladores de la comunidad android alrededor del mundo se ha ido mejorando en estos √∫ltimos meses ya que se le han agregado dos componentes importantes el primero un patr√≥n en la capa de presentaci√≥n que puede ser <a href="https://erikjhordan-rey.github.io/blog/2015/11/02/ANDROID-mvp.html">MVP</a>, <a href="https://erikjhordan-rey.github.io/blog/2015/12/15/ANDROID-databinding-android.html">MVVM</a>, MVC o el que prefieras y el segundo se ha agregado el <a href="http://martinfowler.com/eaaCatalog/repository.html">Repository Pattern</a> en la capa de datos para abstraer el origen de datos y destacar que estos patrones no est√°n dentro de la arquitectura que <strong>Uncle Bob</strong> describe, es trabajo de una comunidad con el √∫nico objetivo de mejorar el desarrollo de nuestras aplicaciones android y si estoy seguro que te encontraras diferentes implementaciones porque realmente no hay un camino a seguir pero particularmente es la que m√°s me gusta y es la que se ha adaptado a mis problemas.</p>

<p>He escrito un ejemplo para demostrar el uso de esta arquitectura el cual he llamado <a href="https://github.com/erikjhordan-rey/Clean-Architecture-Android">Euro-CleanArchitecture</a> y todo el c√≥digo est√° disponible en <strong>github</strong>.</p>

<h3 id="presentation-layer">Presentation Layer</h3>

<p>Es la capa en donde ocurre todo lo relacionado a c√≥mo funcionan la vistas normalmente activities y fragmentos los cuales contienen l√≥gica pero √∫nicamente enfocada en c√≥mo funciona la vistas es decir el que debo mostrarle al usuario y cuando debe hacerlo.
Para lograr un mejor manejo de vistas en esta capa se suelen usar patrones de UI (en el ejemplo que he escrito encontrar√°s MVP).</p>

<p>Yo he escrito un post acerca del <a href="https://erikjhordan-rey.github.io/blog/2015/11/02/ANDROID-mvp.html">MVP</a>) y otro sobre <a href="https://erikjhordan-rey.github.io/blog/2015/12/15/ANDROID-databinding-android.html">MVVM</a> si solo has utilizado MVC dale una mirada a estos posts por que te ayudar√°n a separar tus vistas de la l√≥gica de negocio de una forma elegante.</p>

<h3 id="domain-layer">Domain Layer</h3>

<p>Toda la l√≥gica de negocio ocurre en esta capa aqu√≠ solo lo enfocado a que tiene que hacer nuestra aplicaci√≥n. Se encuentran entidades y casos de uso regularmente es solo c√≥digo java (puede ser kotlin o scala es indiferente) y no hay ninguna dependencia android.</p>

<h3 id="data-layer">Data Layer</h3>

<p>Es la capa en donde se obtienen todos los datos que necesita nuestra aplicaci√≥n para funcionar y los datos pueden ser de prove√≠dos por una base de datos, de la red o de la memoria o de donde nos imaginemos particularmente en android hacemos uso de <a href="http://martinfowler.com/eaaCatalog/repository.html">Repository Pattern</a> un patr√≥n que permite abstraer el origen de datos en donde no va importar de donde vengan los datos lo importante es que seran obtenidos de alg√∫n lugar y podremos utilizarlos para hacer las acciones que tengamos que hacer.</p>

<p>Algo que valdr√≠a la pena mencionar es que cada capa tiene su propio modelo de datos ya que ser√° m√°s f√°cil de testar y modificar para lo que estaremos usamos mappers para estar cambiando objetos de datos a un objeto de dominio y de dominio a un objeto de nuestra vista no quiero indagar mucho aqu√≠ pero cuando veas el c√≥digo te dar√°s cuenta de lo √∫til que es.</p>

<h3 id="benefits-of-using-clean-architecture">Benefits of using Clean Architecture</h3>

<p>Existe una cantidad muy grande de diversas arquitecturas algunas en las cuales Uncle Bob se ha basado son <a href="http://alistair.cockburn.us/Hexagonal+architecture">Hexagonal Architecture</a>, <a href="http://jeffreypalermo.com/blog/the-onion-architecture-part-1/">Onion Architecture</a>, <a href="http://blog.8thlight.com/uncle-bob/2011/09/30/Screaming-Architecture.html">Screaming Architecture</a> y lo importante es que cada una de ellas var√≠a en sus detalles de implementaci√≥n pero todas son similares y tienen el mismo objetivo separar en capas nuestro software con la finalidad de darle flexibilidad.</p>

<p>Las principales aportaciones que esta arquitectura seguir√° motivando son:</p>

<ul>
  <li>Independiente de frameworks</li>
  <li>Testable</li>
  <li>Independendiente de nuestra UI</li>
  <li>Independendiente de nuestra DB</li>
  <li>Independendiente de cualquier herramienta externa</li>
</ul>

<h2 id="clean-architecture-android">Clean-Architecture-Android</h2>

<p>Es un ejemplo de Clean Architecture que lo cree con la intenci√≥n de explicar c√≥mo funciona esta arquitectura dentro de nuestras aplicaciones android tambi√©n puedes encontr√°r el c√≥digo en la parte final del post.</p>

<p><img src="/images/2016/1/euro_app.png" alt="mvp" class="center-image" /></p>

<h3 id="conclusion">Conclusion</h3>

<p>Como ya lo he mencionado arriba solo quedarnos con la idea que Clean Architecture s√≥lo son una serie de reglas a cumplir para crear software por capas dando origen a un c√≥digo flexible, mantenible y testable. Otro aspecto importante que debemos tener en mente  es que no hay camino a seguir que sea el correcto para implementar esta arquitectura  crea la implementaci√≥n que mejor te guste y que resuelva tu problema de la mejor forma pero no olvidar generar c√≥digo que esconda detalles de implementaci√≥n.</p>

<h3 id="talk-clean-architecture-ios">Talk Clean Architecture IOS</h3>

<p>He dado una peque√±a charla hablando sobre estos temas que puedes ver aqu√≠ <a href="https://youtu.be/3wCyFvAiX04">Clean Architecture IOS</a>.</p>

<h3 id="demo">Demo</h3>

<h4 id="el-c√≥digo-est√°-disponible">El c√≥digo est√° disponible</h4>

<h4 id="android">Android</h4>
<p><a href="https://github.com/erikjhordan-rey/Clean-Architecture-Android">Clean-Architecture-Android en Github</a></p>

<p><img src="/images/2016/1/Telecine_2016-04-11-09-46-01.gif" alt="" /></p>

<h4 id="ios">IOS</h4>
<p><a href="https://github.com/ivanhoe/clean-architecture-spotify">Clean-Architecture-IOS en Github</a></p>

<h3 id="resources">Resources</h3>
<ul>
  <li><strong>Robert Martin (Uncle-bob)</strong> - <a href="https://blog.8thlight.com/uncle-bob/2012/08/13/the-clean-architecture.html">The Clean Architecture</a></li>
  <li><strong>Robert Martin (Uncle-bob)</strong> - <a href="https://www.youtube.com/watch?v=WpkDN78P884">Architecture the Lost Years</a></li>
  <li><strong>Karumi</strong> - <a href="https://github.com/Karumi/Rosie">Rosie (is an Android framework to create applications following the principles of Clean Architecture)</a></li>
  <li><strong>Karumi</strong> - <a href="https://www.youtube.com/watch?v=31lWMsCeoSA">Clean Architecture Hangouts (karumi is the biggest contributors to Clean Architecture with wonderful projects, talks and post.)</a></li>
  <li><strong>Fernando Cejas</strong> - <a href="https://github.com/android10/Android-CleanArchitecture">Android-CleanArchitecture (Github Example and Blog Posts)</a></li>
  <li><strong>Jorge Barroso</strong> <a href="https://www.youtube.com/watch?v=ROdIvrLL1ao">Forgetting Android</a></li>
</ul>

<p><strong>‚ÄúBad code affect to your Customer. by Martin Fowler‚Äù</strong></p>
:ET